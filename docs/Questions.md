<!-- TOC -->
* [미션 2-4](#미션-2-4)
* [미션 2-3](#미션-2-3)
* [미션 2-2](#미션-2-2)
* [미션 2-1](#미션-2-1)
  * [리뷰어님 요청사항](#리뷰어님-요청사항)
  * [질문 리스트업](#질문-리스트업)
* [기존](#기존)
  * [예외 처리](#예외-처리)
    * [예외를 언체크 예외가 아니라 체크 예외로 만드는게 맞을지?](#예외를-언체크-예외가-아니라-체크-예외로-만드는게-맞을지)
    * [Assert.notNullField 가 발생할 때 체크 예외로 만들면](#assertnotnullfield-가-발생할-때-체크-예외로-만들면)
    * [커스텀 예외](#커스텀-예외)
  * [CQRS](#cqrs)
    * [쿼리 전용 리포지토리?](#쿼리-전용-리포지토리)
    * [연관된 엔티티를 항상 퍼오기가 귀찮다](#연관된-엔티티를-항상-퍼오기가-귀찮다)
  * [객체지향](#객체지향)
    * [엔티티를 무조건 불변으로 만들필요가 있을까?](#엔티티를-무조건-불변으로-만들필요가-있을까)
  * [테스트](#테스트)
* [궁금증](#궁금증)
<!-- TOC -->

# 미션 2-4

# 미션 2-3

# 미션 2-2

# 미션 2-1

## 리뷰어님 요청사항

- 쿠키나 액세스 토큰 등을 많이 쓰지 않아서 그런데 보안적으로 문제될 사항 없는지 확인하기

## 질문 리스트업

> (PR 올려놓고 코멘트로 따로 질문드릴 예정입니다.)

- [ ] auth.support 패키지 구조 어떤지 질문.
- [ ] JWT Signature를 만들기 위한 Secret Key는 어떻게 만들어야할까?
  - [ ] Secret Key를 어디에 저장해야할까? 단순히 환경변수로 주입?
- [ ] (테스트) 인증을 포함하려니 테스트하기가 상당히 어려움.
  - 예를 들면 인증이 필요한 API E2E 테스트를 하려면, 먼저 로그인을 해야해서 LoginFixture를 만들었음.
  - 매번 쿠키에 accessToken을 할당해야하는데 너~무 귀찮음. 어떻게 해결하지?
  - LoginFixture 이 방법이 괜찮은지?
- [ ] 인증 테스트 시에 매번 로그인 처리를 어떻게 해야할까?
  - [ ] LoginFixture 처럼 실제 로그인 API를 호출해서 매번 로그인 처리 해주는게 좋은 구조인지 고민됨.
- [ ] (권한 테스트) 모든 API 테스트 마다 권한이 없을 때 실패하는 API 테스트를 작성한다?

---

# 기존

## 예외 처리

### 예외를 언체크 예외가 아니라 체크 예외로 만드는게 맞을지?

- @Transactional에 의한 AOP 객체 생성시 체크 예외 발생 시 기본 처리 전략은 커밋
  - 언체크 예외는 롤백된다.
- 체크예외 잡는 것은 강제하는 효과가 있어서 좋긴하지만,
- 언체크 예외를 발생할 것을 대비해서
- 언체크 예외를 예상해서 못잡았다면 @RestControllerAdvice를 통해서 예외를 처리하는 게 편하지. 모든 로직에서 전부 예외를 핸들링 해줄 수는 없는 노릇
- 단순 null field 예외도 상위에서 전부 try-catch 해주거나 아니면 그 위로 계속 throws를 하는 것이 오히려 부담
- 런타임 예외 발생 시 트랜잭션이 롤백되는 것이 싫으면 try-catch로 묶으면 되지 않나?
- 비즈니스 예외를 체크로 할 경우의 장점
  - 결제 - 잔고부족 케이스에서,
    - 결제 요청 시 결제 상태를 실패로 바꾸고 잔고 부족 예외를 던진다.
    - 만약에 이 때 잔고 부족 예외가 런타임 예외였으면 결제 상태를 실패로 바꾸는 로직도 롤백되어버리는 문제가 있음.

### Assert.notNullField 가 발생할 때 체크 예외로 만들면

- 모든 비즈니스 예외를 체크예외로 만들어야할까?
- 단순 필수값 입력 등은 비즈니스 예외로 보고
  - 모든 메서드에서 throws 를 하고 있게 될 확률이 높아짐.
    - 👉 결제 실패 등만 비즈니스 로직으로 보면 어떨지?
- `@Column(nullable = false)`에서 발생하는 ConstraintViolationException도 RuntimeException이다. 따라서 단순
  null field 예외도 runtime exception으로 관리해도 되지 않을까? 하고 생각함.

### 커스텀 예외

- 커스텀 에러 코드를 를 한 번 추가하고 나니까 예외 클래스가 생길 때마다 계속 에러 코드를 만들어줘야할 것 같음. 어떻게 설계해야할지?
- [ ] 리뷰어 분께 예외 처리 구조 위주로 봐달라고 말씀드리기

---

## CQRS

### 쿼리 전용 리포지토리?

### 연관된 엔티티를 항상 퍼오기가 귀찮다

- 직접 참조로 인해 발생할 수 있는 트레이드 오프
  - TDA를 어기는 등의 위험 발생 가능.
- 간접 참조로 조회 시 먼저 엔티티 한 개 조회하고, 그 엔티티의 FK로 조회하고.. 이런 트레이드 오프 고민이 너무 많다.

---

## 객체지향

### 엔티티를 무조건 불변으로 만들필요가 있을까?

- 값 객체의 경우 자원 공유로 인해서 불변으로 했을 때의 장점을
- 빌더를 이용해서 조립하고 있는데
-

---

## 테스트

-

---

# 궁금증

- 어드민용이랑 고객용 취소 정책이 다르다고 할 때, 이걸 어떻게 구현해야할까?
  - 어드민에서는 당일 취소가 가능하고, 고객용에서는 당일 취소는 불가능하다고 정책을 가져간다고 하자.
  - 사용하는 API 자체를 다르게 할텐데, 예약 객체에게 취소 메시지를 보낼 때 취소 전략 구현체를 어드민/사용자에 따라 다르게 넘김으로서 다형성으로 구현할까?
